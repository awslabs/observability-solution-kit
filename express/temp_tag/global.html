<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Global</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="";baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body data-theme="dark"><div class="sidebar-container"><div class="sidebar" id="sidebar"><a href="index.html" class="sidebar-title">O11yv: NodeExpress</a><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-classes"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="ContextAwareSqsConsumer.html">ContextAwareSqsConsumer</a></div><div class="sidebar-section-children"><a href="ContextAwareSqsProducer.html">ContextAwareSqsProducer</a></div><div class="sidebar-section-children"><a href="Log.html">Log</a></div><div class="sidebar-section-children"><a href="LogContextStore.html">LogContextStore</a></div><div class="sidebar-section-children"><a href="logFormatter.html">logFormatter</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-global"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#before">before</a></div><div class="sidebar-section-children"><a href="global.html#closeSegment">closeSegment</a></div><div class="sidebar-section-children"><a href="global.html#config">config</a></div><div class="sidebar-section-children"><a href="global.html#consts">consts</a></div><div class="sidebar-section-children"><a href="global.html#contextMiddleware">contextMiddleware</a></div><div class="sidebar-section-children"><a href="global.html#extract">extract</a></div><div class="sidebar-section-children"><a href="global.html#getJwtFromRequest">getJwtFromRequest</a></div><div class="sidebar-section-children"><a href="global.html#getServiceName">getServiceName</a></div><div class="sidebar-section-children"><a href="global.html#getTenantAttributes">getTenantAttributes</a></div><div class="sidebar-section-children"><a href="global.html#getTraceIdFromRequest">getTraceIdFromRequest</a></div><div class="sidebar-section-children"><a href="global.html#isLoggingEnabled">isLoggingEnabled</a></div><div class="sidebar-section-children"><a href="global.html#isNotLoggingEnabled">isNotLoggingEnabled</a></div><div class="sidebar-section-children"><a href="global.html#logFormattingMap">logFormattingMap</a></div><div class="sidebar-section-children"><a href="global.html#logger">logger</a></div><div class="sidebar-section-children"><a href="global.html#on">on</a></div><div class="sidebar-section-children"><a href="global.html#openSegment">openSegment</a></div><div class="sidebar-section-children"><a href="global.html#proxyLogger">proxyLogger</a></div><div class="sidebar-section-children"><a href="global.html#setSegmentWithTraceHeader">setSegmentWithTraceHeader</a></div><div class="sidebar-section-children"><a href="global.html#start">start</a></div><div class="sidebar-section-children"><a href="global.html#tenantAwareHandleMessage">tenantAwareHandleMessage</a></div><div class="sidebar-section-children"><a href="global.html#winstonLogger">winstonLogger</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section><article><div class="container-overview"></div><h2 id="members" class="subsection-title has-anchor">Members</h2><h3 class="name has-anchor" id="config"><span class="type-signature"></span>config<span class="type-signature"></span></h3><div class="description"><p>This module exports a default instance of the <code>PropertiesReader</code> class, which is used to read configuration properties from a properties file. The properties file name is determined based on the current environment (NODE_ENV) and an optional SDK prefix (SDK_PREFIX). The default file name format is <code>${SDK_PREFIX}${NODE_ENV}.properties</code>. If NODE_ENV is not set, the default environment is assumed to be &quot;local&quot;. If SDK_PREFIX is not set, it defaults to an empty string.</p><p>The <code>PropertiesReader</code> class allows for easy parsing and retrieval of properties from the properties file, making it convenient for handling application configuration in a key-value format.</p></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="configuration_index.js.html">configuration/index.js</a>, <a href="configuration_index.js.html#line23">line 23</a></li></ul></dd></div></dl><b>Example</b><div class="rel"><pre class="prettyprint"><code>// Usage in other modules:
import config from './path/to/config.js';

// Accessing configuration properties
const value = config.get('property.key');</code></pre></div><h3 class="name has-anchor" id="consts"><span class="type-signature">(constant) </span>consts<span class="type-signature"> :object</span></h3><div class="description"><p>This object exports various constant properties used throughout the SDK. Each property represents a specific constant value used in different parts of the SDK. The comments describe the purpose of each constant property.</p></div><div class="member-item-container flex"><strong>Type:</strong><ul><li><span class="param-type">object</span></li></ul></div><b class="subsection-title">Properties</b><div class="allow-overflow"><table class="props"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>UNKNOWN</code></td><td class="type"><span class="param-type">string</span></td><td class="description last"><p>Represents an unknown value or default when a specific value is not available.</p></td></tr><tr><td class="name"><code>EXTRACT_INDEX</code></td><td class="type"><span class="param-type">number</span></td><td class="description last"><p>The index used for extracting elements from an array or other data structures.</p></td></tr><tr><td class="name"><code>ATTRIBUTES_KEY</code></td><td class="type"><span class="param-type">string</span></td><td class="description last"><p>The key used for tenant-aware attributes in an SQS message.</p></td></tr><tr><td class="name"><code>LOG_STORAGE_KEY</code></td><td class="type"><span class="param-type">string</span></td><td class="description last"><p>The key used to store log context in an AsyncLocalStorage store.</p></td></tr><tr><td class="name"><code>CHILD_LOGGER_KEY</code></td><td class="type"><span class="param-type">string</span></td><td class="description last"><p>The key used to store a child logger in an AsyncLocalStorage store.</p></td></tr><tr><td class="name"><code>CALLER_PREFIX</code></td><td class="type"><span class="param-type">string</span></td><td class="description last"><p>Prefix used to identify the caller in logs, specifically for ECS services.</p></td></tr><tr><td class="name"><code>TRACE_KEY_IN_SQS_HEADER</code></td><td class="type"><span class="param-type">string</span></td><td class="description last"><p>The key for the AWS X-Ray trace header in SQS message attributes.</p></td></tr><tr><td class="name"><code>ECS_FARGATE_ORIGIN</code></td><td class="type"><span class="param-type">string</span></td><td class="description last"><p>The origin identifier for AWS Fargate services in ECS (Elastic Container Service).</p></td></tr><tr><td class="name"><code>DEFAULT_CONSUMER_NAME</code></td><td class="type"><span class="param-type">string</span></td><td class="description last"><p>The default name for the SQS consumer.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="const_consts.js.html">const/consts.js</a>, <a href="const_consts.js.html#line1">line 1</a></li></ul></dd></div></dl><h3 class="name has-anchor" id="logFormattingMap"><span class="type-signature">(constant) </span>logFormattingMap<span class="type-signature"> :object</span></h3><div class="description"><p>This object exports a mapping of log message properties to tenant and user context. Each property key represents a specific property path in the log message, and its value represents the corresponding context key. When applied to a log message, these property keys will be replaced by the corresponding context values, if available. For example, 'tenant.organizationId' in the log message will be replaced by the actual tenant organization ID from the context. This mapping helps to enrich log messages with tenant and user context information for better log analysis and monitoring.</p></div><div class="member-item-container flex"><strong>Type:</strong><ul><li><span class="param-type">object</span></li></ul></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="layout_logLayout.js.html">layout/logLayout.js</a>, <a href="layout_logLayout.js.html#line1">line 1</a></li></ul></dd></div></dl><h3 class="name has-anchor" id="logger"><span class="type-signature">(constant) </span>logger<span class="type-signature"> :<a href="Log.html">Log</a></span></h3><div class="description"><p>This constant creates a Log instance for application logging. The 'isLoggingEnabled()' function determines whether logging is enabled or not. If logging is enabled, it uses the proxyLogger, which checks for a child logger in the logContextStore. Otherwise, it falls back to console logging.</p></div><div class="member-item-container flex"><strong>Type:</strong><ul><li><span class="param-type"><a href="Log.html">Log</a></span></li></ul></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="index.js.html">index.js</a>, <a href="index.js.html#line43">line 43</a></li></ul></dd></div></dl><h3 class="name has-anchor" id="proxyLogger"><span class="type-signature">(constant) </span>proxyLogger<span class="type-signature"> :Proxy</span></h3><div class="description"><p>This Proxy object intercepts the access to the winstonLogger and checks for a child logger instance stored in the logContextStore. If a child logger is found in the store, it uses the child logger; otherwise, it falls back to the original winstonLogger.</p></div><div class="member-item-container flex"><strong>Type:</strong><ul><li><span class="param-type">Proxy</span></li></ul></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="service_loggerCreator.js.html">service/loggerCreator.js</a>, <a href="service_loggerCreator.js.html#line49">line 49</a></li></ul></dd></div></dl><h3 class="name has-anchor" id="winstonLogger"><span class="type-signature">(constant) </span>winstonLogger<span class="type-signature"> :winston.Logger</span></h3><div class="description"><p>This logger instance is initialized with various log formatting options and a Console transport. The logger utilizes the Winston library for efficient logging and supports JSON formatting of logs.</p></div><div class="member-item-container flex"><strong>Type:</strong><ul><li><span class="param-type">winston.<wbr>Logger</span></li></ul></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="service_loggerCreator.js.html">service/loggerCreator.js</a>, <a href="service_loggerCreator.js.html#line14">line 14</a></li></ul></dd></div></dl><h2 id="methods" class="subsection-title has-anchor">Methods</h2><h3 class="name has-anchor" id="before"><span class="type-signature"></span>before<span class="signature">(request)</span><span class="type-signature"> &rarr; {object}</span></h3><div class="description"><p>This function is used to extract log context from the incoming request for logging purposes. It starts by retrieving the JWT (JSON Web Token) from the request using tokenDirector.getJwtFromRequest(). The JWT is then decoded, and the context information is extracted using contextExtractor.extract(). Next, the extracted context information is formatted according to the logFormattingMap using logFormatter.apply(). Additionally, it includes the Trace ID from the request headers by calling headerDirector.getTraceIdFromRequest(). The formatted log context, including the extracted and formatted context information along with the Trace ID, is returned to be used for logging during the request processing.</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>request</code></td><td class="type"><span class="param-type">object</span></td><td class="description last"><p>The request object.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="middleware_loggingMiddleware.js.html">middleware/loggingMiddleware.js</a>, <a href="middleware_loggingMiddleware.js.html#line7">line 7</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><div class="param-desc"><p>The formatted log context extracted from the request.</p></div><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type">object</span></dd></dl></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Example</strong><div class="rel"><pre class="prettyprint"><code>const requestObj = {
  headers: {
    authorization: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "x-amzn-trace-id": "1234567890abcdef"
  }
};
const logContext = before(requestObj);
console.log(logContext);
// Output:
// {
//   userId: "user123",
//   clientId: "client789",
//   traceId: "1234567890abcdef"
// }</code></pre></div></div><h3 class="name has-anchor" id="closeSegment"><span class="type-signature"></span>closeSegment<span class="signature">()</span><span class="type-signature"> &rarr; {void}</span></h3><div class="description"><p>This function closes the current AWS X-Ray segment, finishing the tracing for the current operation.</p></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="index.js.html">index.js</a>, <a href="index.js.html#line69">line 69</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type">void</span></dd></dl></div><h3 class="name has-anchor" id="contextMiddleware"><span class="type-signature"></span>contextMiddleware<span class="signature">(request, response, next)</span><span class="type-signature"> &rarr; {void}</span></h3><div class="description"><p>This middleware function extracts the logContext for each incoming request using the loggingContextMiddleware. It creates a child logger from the winstonLogger instance and stores both the child logger and the logContext in an AsyncLocalStorage store, accessible through logContextStore, to enable logging with the tenantContext. If logging is disabled (checked via isNotLoggingEnabled()), the middleware skips the logging setup and proceeds to the next middleware in the chain.</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>request</code></td><td class="type"><span class="param-type">object</span></td><td class="description last"><p>The request object.</p></td></tr><tr><td class="name"><code>response</code></td><td class="type"><span class="param-type">object</span></td><td class="description last"><p>The response object.</p></td></tr><tr><td class="name"><code>next</code></td><td class="type"><span class="param-type">function</span></td><td class="description last"><p>The next middleware function in the chain.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="index.js.html">index.js</a>, <a href="index.js.html#line11">line 11</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type">void</span></dd></dl></div><h3 class="name has-anchor" id="extract"><span class="type-signature"></span>extract<span class="signature">(jwtFromRequest)</span><span class="type-signature"> &rarr; {object}</span></h3><div class="description"><p>This function extracts information from the given JWT token and returns it as an object. If no JWT token is provided, an empty object is returned.</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>jwtFromRequest</code></td><td class="type"><span class="param-type">string</span></td><td class="description last"><p>The JWT token to extract information from.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="service_contextExtractor.js.html">service/contextExtractor.js</a>, <a href="service_contextExtractor.js.html#line26">line 26</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><div class="param-desc"><p>An object containing the decoded information from the JWT.</p></div><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type">object</span></dd></dl></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Example</strong><div class="rel"><pre class="prettyprint"><code>const jwtToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...";
const extractedInfo = extract(jwtToken);
console.log(extractedInfo);

// Output:
// {
//   "userId": 123,
//   "username": "john_doe",
//   "exp": 1674889721
// }</code></pre></div></div><h3 class="name has-anchor" id="getJwtFromRequest"><span class="type-signature"></span>getJwtFromRequest<span class="signature">(request)</span><span class="type-signature"> &rarr; {string}</span></h3><div class="description"><p>This function attempts to extract a JWT token from the provided request object's headers or cookies. It first checks if the &quot;cookie&quot; header is available and tries to find a token part in it using the &quot;token=&quot; pattern. If a token is found in the cookie, it is returned as the JWT token. If not found in the cookie, the function checks the &quot;authorization&quot; header for a JWT token. If found, it returns the JWT token from the &quot;authorization&quot; header. If neither the cookie nor the authorization header contains a JWT token, an empty string is returned.</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>request</code></td><td class="type"><span class="param-type">object</span></td><td class="description last"><p>The request object containing headers and cookies.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="service_tokenDirector.js.html">service/tokenDirector.js</a>, <a href="service_tokenDirector.js.html#line43">line 43</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><div class="param-desc"><p>The extracted JWT token, or an empty string if not found.</p></div><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type">string</span></dd></dl></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Examples</strong><div class="rel"><pre class="prettyprint"><code>// Example 1: JWT token is present in the "cookie" header.
const requestObj = {
  headers: {
    cookie: "some_cookie_name=abc; token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9; other_cookie_name=xyz;"
  }
};
const jwtToken = getJwtFromRequest(requestObj);
console.log(jwtToken); // Output: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"</code></pre></div><div class="rel"><pre class="prettyprint"><code>// Example 2: JWT token is present in the "authorization" header.
const requestObj = {
  headers: {
    authorization: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"
  }
};
const jwtToken = getJwtFromRequest(requestObj);
console.log(jwtToken); // Output: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"</code></pre></div><div class="rel"><pre class="prettyprint"><code>// Example 3: JWT token is not found in headers or cookies.
const requestObj = {
  headers: {}
};
const jwtToken = getJwtFromRequest(requestObj);
console.log(jwtToken); // Output: ""</code></pre></div></div><h3 class="name has-anchor" id="getServiceName"><span class="type-signature"></span>getServiceName<span class="signature">()</span><span class="type-signature"> &rarr; {string}</span></h3><div class="description"><p>Retrieves the service name from the application's configuration.</p></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="configuration_director.js.html">configuration/director.js</a>, <a href="configuration_director.js.html#line24">line 24</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><div class="param-desc"><p>The service name, or consts.UNKNOWN if not specified in the configuration.</p></div><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type">string</span></dd></dl></div><h3 class="name has-anchor" id="getTenantAttributes"><span class="type-signature"></span>getTenantAttributes<span class="signature">(message)</span><span class="type-signature"> &rarr; {object}</span></h3><div class="description"><p>This function extracts tenant context attributes from the SQS message for logging purposes. It looks for the 'MessageAttributes' property in the message, specifically the attribute with key consts.ATTRIBUTES_KEY. If the attribute exists and contains a valid JSON string, it is parsed to obtain the tenant context. If the attribute is not properly formatted or missing, an empty object is returned for the tenant context.</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>message</code></td><td class="type"><span class="param-type">object</span></td><td class="description last"><p>The SQS message containing attributes.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="message_contextAwareSqsConsumer.js.html">message/contextAwareSqsConsumer.js</a>, <a href="message_contextAwareSqsConsumer.js.html#line42">line 42</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><div class="param-desc"><p>The extracted tenant context as an object.</p></div><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type">object</span></dd></dl></div><h3 class="name has-anchor" id="getTraceIdFromRequest"><span class="type-signature"></span>getTraceIdFromRequest<span class="signature">(request, request)</span><span class="type-signature"> &rarr; {string}</span></h3><div class="description"><p>This function retrieves the Trace ID from the headers of the given request object. If the &quot;x-amzn-trace-id&quot; header exists in the request, it will be returned as the Trace ID. If the header is not found or empty, a default value (consts.UNKNOWN) will be returned.</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>request</code></td><td class="type"><span class="param-type">object</span></td><td class="description last"><p>The request object containing headers.</p></td></tr><tr><td class="name"><code>request</code></td><td class="type"><span class="param-type">object</span></td><td class="description last"><p>The request object containing headers.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="service_headerDirector.js.html">service/headerDirector.js</a>, <a href="service_headerDirector.js.html#line34">line 34</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><div class="param-desc"><p>The Trace ID extracted from the request headers, or a default value if not found.</p></div><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type">string</span></dd></dl></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Examples</strong><div class="rel"><pre class="prettyprint"><code>const requestObj = {
  headers: {
    "x-amzn-trace-id": "1234567890abcdef"
  }
};

const traceId = getTraceIdFromRequest(requestObj);
console.log(traceId); // Output: "1234567890abcdef"</code></pre></div><div class="rel"><pre class="prettyprint"><code>const requestObj = {
  headers: {}
};

const traceId = getTraceIdFromRequest(requestObj);
console.log(traceId); // Output: "unknown" (default value from consts)</code></pre></div></div><h3 class="name has-anchor" id="isLoggingEnabled"><span class="type-signature"></span>isLoggingEnabled<span class="signature">()</span><span class="type-signature"> &rarr; {boolean}</span></h3><div class="description"><p>Checks whether logging is enabled in the application's configuration.</p></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="configuration_director.js.html">configuration/director.js</a>, <a href="configuration_director.js.html#line4">line 4</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><div class="param-desc"><p>True if logging is enabled, otherwise false.</p></div><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type">boolean</span></dd></dl></div><h3 class="name has-anchor" id="isNotLoggingEnabled"><span class="type-signature"></span>isNotLoggingEnabled<span class="signature">()</span><span class="type-signature"> &rarr; {boolean}</span></h3><div class="description"><p>Checks whether logging is not enabled in the application's configuration.</p></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="configuration_director.js.html">configuration/director.js</a>, <a href="configuration_director.js.html#line14">line 14</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><div class="param-desc"><p>True if logging is not enabled, otherwise false.</p></div><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type">boolean</span></dd></dl></div><h3 class="name has-anchor" id="on"><span class="type-signature"></span>on<span class="signature">(eventName, listener)</span><span class="type-signature"> &rarr; {void}</span></h3><div class="description"><p>Adds a listener for the specified event to the SQS consumer.</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>eventName</code></td><td class="type"><span class="param-type">string</span></td><td class="description last"><p>The name of the event to listen for.</p></td></tr><tr><td class="name"><code>listener</code></td><td class="type"><span class="param-type">function</span></td><td class="description last"><p>The event listener function.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="message_contextAwareSqsConsumer.js.html">message/contextAwareSqsConsumer.js</a>, <a href="message_contextAwareSqsConsumer.js.html#line143">line 143</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type">void</span></dd></dl></div><h3 class="name has-anchor" id="openSegment"><span class="type-signature"></span>openSegment<span class="signature">()</span><span class="type-signature"> &rarr; {object}</span></h3><div class="description"><p>This function opens an AWS X-Ray segment for tracing the current operation. The segment name is obtained from the 'getServiceName()' function.</p></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="index.js.html">index.js</a>, <a href="index.js.html#line56">line 56</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><div class="param-desc"><p>The AWS X-Ray segment.</p></div><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type">object</span></dd></dl></div><h3 class="name has-anchor" id="setSegmentWithTraceHeader"><span class="type-signature"></span>setSegmentWithTraceHeader<span class="signature">(message)</span><span class="type-signature"> &rarr; {void}</span></h3><div class="description"><p>This function sets up the AWS X-Ray segment based on the trace header attribute present in the SQS message. If the trace header exists, it is processed to obtain the trace data, and an X-Ray segment is created with that information. The segment name is set to the service name obtained from getServiceName(). If the sampling decision indicates that the segment should not be traced, the 'notTraced' property is set accordingly. The created segment is set as the current segment using AWSXRay.setSegment().</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>message</code></td><td class="type"><span class="param-type">object</span></td><td class="description last"><p>The SQS message containing the trace header attribute.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="message_contextAwareSqsConsumer.js.html">message/contextAwareSqsConsumer.js</a>, <a href="message_contextAwareSqsConsumer.js.html#line70">line 70</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type">void</span></dd></dl></div><h3 class="name has-anchor" id="start"><span class="type-signature"></span>start<span class="signature">()</span><span class="type-signature"> &rarr; {void}</span></h3><div class="description"><p>Starts the SQS consumer to listen for messages from the SQS queue.</p></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="message_contextAwareSqsConsumer.js.html">message/contextAwareSqsConsumer.js</a>, <a href="message_contextAwareSqsConsumer.js.html#line133">line 133</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type">void</span></dd></dl></div><h3 class="name has-anchor" id="tenantAwareHandleMessage"><span class="type-signature">(async) </span>tenantAwareHandleMessage<span class="signature">(message)</span><span class="type-signature"> &rarr; {Promise.&lt;void>}</span></h3><div class="description"><p>This function handles the incoming SQS message with tenant-aware context for logging purposes. It sets up the AWS X-Ray segment based on the trace header from the SQS message. If logging is disabled (checked via isNotLoggingEnabled()), the original handleMessage function is called directly with the message. When logging is enabled, the function extracts the tenant context attributes from the message using getTenantAttributes(). It then creates a child logger with the extracted log context using winstonLogger.child(). Both the child logger and the log context are stored in an AsyncLocalStorage store logContextStore. The store is then used to execute the original handleMessage function with log context available in the logContextStore. The segment is closed at the end of message handling using this.segment.close().</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>message</code></td><td class="type"><span class="param-type">object</span></td><td class="description last"><p>The SQS message to be handled.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="message_contextAwareSqsConsumer.js.html">message/contextAwareSqsConsumer.js</a>, <a href="message_contextAwareSqsConsumer.js.html#line94">line 94</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type">Promise.&lt;void></span></dd></dl></div></article></section></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><a href="index.html" class="sidebar-title">O11yv: NodeExpress</a><div class="mobile-nav-links"></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-classes"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="ContextAwareSqsConsumer.html">ContextAwareSqsConsumer</a></div><div class="sidebar-section-children"><a href="ContextAwareSqsProducer.html">ContextAwareSqsProducer</a></div><div class="sidebar-section-children"><a href="Log.html">Log</a></div><div class="sidebar-section-children"><a href="LogContextStore.html">LogContextStore</a></div><div class="sidebar-section-children"><a href="logFormatter.html">logFormatter</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-global"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#before">before</a></div><div class="sidebar-section-children"><a href="global.html#closeSegment">closeSegment</a></div><div class="sidebar-section-children"><a href="global.html#config">config</a></div><div class="sidebar-section-children"><a href="global.html#consts">consts</a></div><div class="sidebar-section-children"><a href="global.html#contextMiddleware">contextMiddleware</a></div><div class="sidebar-section-children"><a href="global.html#extract">extract</a></div><div class="sidebar-section-children"><a href="global.html#getJwtFromRequest">getJwtFromRequest</a></div><div class="sidebar-section-children"><a href="global.html#getServiceName">getServiceName</a></div><div class="sidebar-section-children"><a href="global.html#getTenantAttributes">getTenantAttributes</a></div><div class="sidebar-section-children"><a href="global.html#getTraceIdFromRequest">getTraceIdFromRequest</a></div><div class="sidebar-section-children"><a href="global.html#isLoggingEnabled">isLoggingEnabled</a></div><div class="sidebar-section-children"><a href="global.html#isNotLoggingEnabled">isNotLoggingEnabled</a></div><div class="sidebar-section-children"><a href="global.html#logFormattingMap">logFormattingMap</a></div><div class="sidebar-section-children"><a href="global.html#logger">logger</a></div><div class="sidebar-section-children"><a href="global.html#on">on</a></div><div class="sidebar-section-children"><a href="global.html#openSegment">openSegment</a></div><div class="sidebar-section-children"><a href="global.html#proxyLogger">proxyLogger</a></div><div class="sidebar-section-children"><a href="global.html#setSegmentWithTraceHeader">setSegmentWithTraceHeader</a></div><div class="sidebar-section-children"><a href="global.html#start">start</a></div><div class="sidebar-section-children"><a href="global.html#tenantAwareHandleMessage">tenantAwareHandleMessage</a></div><div class="sidebar-section-children"><a href="global.html#winstonLogger">winstonLogger</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>